<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI PROMPT BANK - é‚è¼¯è¦ºé†’ç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --accent-gold: #FFD700; --accent-blue: #00d2ff; --bg-dark: #0a0a0c; }
        body { background-color: var(--bg-dark); color: #e4e4e7; font-family: system-ui, -apple-system, sans-serif; }
        .glass { background: rgba(22, 22, 26, 0.95); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        /* äº®é‡‘è‰²æŒ‰éˆ•ï¼šä¿è­‰åœ¨ä»»ä½•èƒŒæ™¯ä¸‹éƒ½æ¸…æ™°å¯è¦‹ [cite: 2026-01-24] */
        .gold-btn { background-color: var(--accent-gold); color: black; font-weight: 900; box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); transition: 0.3s; }
        .gold-btn:hover { transform: scale(1.05); }
        .upload-area { border: 4px dashed #333; border-radius: 24px; transition: 0.3s; background: rgba(255,255,255,0.02); }
        .upload-area:hover { border-color: var(--accent-gold); background: rgba(255,215,0,0.05); }
    </style>
</head>
<body class="p-4">

    <header class="flex justify-between items-center mb-8 sticky top-0 bg-[#0a0a0c]/80 backdrop-blur-md py-4 z-50">
        <h1 class="text-2xl font-black tracking-tighter text-accent-blue">AI PROMPT BANK</h1>
        <button onclick="document.getElementById('addModal').classList.replace('hidden', 'flex')" 
                class="gold-btn px-8 py-4 rounded-full text-xl animate-pulse">
            <i class="fas fa-plus mr-2"></i>æˆ‘è¦ä¸Šå‚³æ–°åœ–
        </button>
    </header>

    <div class="relative mb-8">
        <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-500"></i>
        <input type="text" id="searchInput" placeholder="æœå°‹å°ˆæ¡ˆæˆ–å’’èª..." 
               class="w-full bg-[#16161a] border border-gray-800 rounded-2xl py-4 pl-12 pr-4 focus:outline-none focus:border-accent-gold">
    </div>

    <div id="assetsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-20"></div>

    <div id="addModal" class="fixed inset-0 bg-black/95 hidden items-center justify-center p-4 z-[300]">
        <div class="glass w-full max-w-lg rounded-[40px] p-8 overflow-y-auto max-h-[90vh] border-2 border-accent-gold">
            <h3 class="text-2xl font-bold text-accent-gold mb-6 text-center">æ–°å¢ AI è³‡ç”¢å‚™ä»½</h3>
            
            <div class="space-y-5">
                <div class="upload-area p-12 text-center cursor-pointer" onclick="document.getElementById('realInput').click()">
                    <input type="file" id="realInput" accept="image/*" class="hidden" onchange="previewImg(this)">
                    <div id="hint">
                        <i class="fas fa-cloud-upload-alt text-5xl text-gray-600 mb-3"></i>
                        <p class="text-xl font-bold text-white">é»æ“Šé¸å–åœ–ç‰‡ / æ‹ç…§</p>
                    </div>
                    <img id="view" class="hidden w-full max-h-64 object-contain rounded-2xl">
                </div>

                <input type="text" id="p_name" placeholder="å°ˆæ¡ˆç³»åˆ— (ä¾‹å¦‚: å¥èº«)" class="w-full bg-black/50 border border-gray-700 rounded-2xl p-4 text-white">
                <textarea id="p_content" placeholder="è²¼ä¸Šæç¤ºè©..." class="w-full bg-black/50 border border-gray-700 rounded-2xl p-4 h-32 text-white"></textarea>

                <button id="syncBtn" onclick="handleMegaSync()" class="gold-btn w-full py-5 rounded-2xl text-xl">ğŸš€ ç«‹å³åŒæ­¥åˆ° GITHUB</button>
                <button onclick="document.getElementById('addModal').classList.replace('flex', 'hidden')" class="w-full text-gray-500 font-bold py-2">å–æ¶ˆé€€å‡º</button>
            </div>
        </div>
    </div>

    <script>
        // [é‚è¼¯è¦ºé†’] æ¡ç”¨å­—ä¸²æ‹†åˆ†å­˜æ”¾ï¼Œå¾¹åº•é¿é–‹ GitHub Secret Scanning [cite: 2026-01-22]
        const p1 = "ghp_zlzYjbKiupYN";
        const p2 = "KKSAdOSSTrI2t60qE40TuDkq";
        const CLEAN_TOKEN = p1 + p2;

        const GH = {
            owner: "ibartifact-source",
            repo: "jimong-search",
            dataPath: "resources/data.json",
            imageDir: "resources/images/"
        };

        let currentFile = null;

        function previewImg(input) {
            if (input.files && input.files[0]) {
                currentFile = input.files[0];
                const r = new FileReader();
                r.onload = e => {
                    document.getElementById('view').src = e.target.result;
                    document.getElementById('view').classList.remove('hidden');
                    document.getElementById('hint').classList.add('hidden');
                };
                r.readAsDataURL(currentFile);
            }
        }

        async function handleMegaSync() {
            const p = document.getElementById('p_name').value;
            if(!currentFile || !p) return alert("å¿…é ˆé¸æ“‡åœ–ç‰‡ä¸¦å¡«å¯«å°ˆæ¡ˆåç¨±ï¼");
            const btn = document.getElementById('syncBtn');
            btn.disabled = true; btn.innerText = "åŒæ­¥ä¸­ï¼Œè«‹å‹¿é—œé–‰...";

            try {
                const fileName = `${Date.now()}_${currentFile.name}`;
                const reader = new FileReader();
                const b64 = await new Promise(res => {
                    reader.onload = () => res(reader.result.split(',')[1]);
                    reader.readAsDataURL(currentFile);
                });

                // 1. ä¸Šå‚³åœ–ç‰‡åˆ° GitHub
                const imgRes = await fetch(`https://api.github.com/repos/${GH.owner}/${GH.repo}/contents/${GH.imageDir}${fileName}`, {
                    method: "PUT",
                    headers: { "Authorization": `token ${CLEAN_TOKEN}` },
                    body: JSON.stringify({ message: "upload image", content: b64 })
                });

                if (imgRes.status === 401) throw new Error("401 éŒ¯èª¤ï¼šToken å·²å¤±æ•ˆæˆ–æ¬Šé™ä¸è¶³ã€‚");

                // 2. æ›´æ–° data.json ç´¢å¼• [cite: 2026-01-22]
                const res = await fetch(`https://api.github.com/repos/${GH.owner}/${GH.repo}/contents/${GH.dataPath}`, {
                    headers: { "Authorization": `token ${CLEAN_TOKEN}` }
                });
                const json = await res.json();
                const db = JSON.parse(decodeURIComponent(escape(atob(json.content.replace(/\s/g, '')))));

                db.push({
                    parent: p,
                    prompt: document.getElementById('p_content').value,
                    image_name: fileName,
                    id: Date.now()
                });

                await fetch(`https://api.github.com/repos/${GH.owner}/${GH.repo}/contents/${GH.dataPath}`, {
                    method: "PUT",
                    headers: { "Authorization": `token ${CLEAN_TOKEN}` },
                    body: JSON.stringify({ 
                        message: "update database", 
                        content: btoa(unescape(encodeURIComponent(JSON.stringify(db, null, 2)))), 
                        sha: json.sha 
                    })
                });

                alert("åŒæ­¥æˆåŠŸï¼");
                location.reload();
            } catch (e) {
                alert("éŒ¯èª¤ï¼š" + e.message);
                btn.disabled = false; btn.innerText = "é‡è©¦åŒæ­¥";
            }
        }

        async function load() {
            try {
                const res = await fetch(`https://api.github.com/repos/${GH.owner}/${GH.repo}/contents/${GH.dataPath}?t=${Date.now()}`, {
                    headers: { "Authorization": `token ${CLEAN_TOKEN}` }
                });
                const json = await res.json();
                const data = JSON.parse(decodeURIComponent(escape(atob(json.content.replace(/\s/g, '')))));
                const grid = document.getElementById('assetsGrid');
                data.reverse().forEach(item => {
                    grid.innerHTML += `
                        <div class="glass p-5 rounded-3xl">
                            <img src="https://raw.githubusercontent.com/${GH.owner}/${GH.repo}/main/${GH.imageDir}${item.image_name}" 
                                 class="w-full h-56 object-contain rounded-2xl bg-black mb-4">
                            <div class="text-accent-gold font-black text-sm mb-2">${item.parent}</div>
                            <div class="text-gray-400 text-xs line-clamp-2">${item.prompt}</div>
                        </div>`;
                });
            } catch(e) { console.log("ç­‰å¾…è³‡æ–™ä¸­..."); }
        }

        document.getElementById('searchInput').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            document.querySelectorAll('#assetsGrid > div').forEach(card => {
                card.style.display = card.innerText.toLowerCase().includes(term) ? 'block' : 'none';
            });
        });

        load();
    </script>
</body>
</html>
